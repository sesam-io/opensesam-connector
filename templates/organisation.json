{
  "_id": "{{@ system @}}-organisation-enhance",
  "type": "pipe",
  "source": {
    "type": "dataset",
    "dataset": "{{@ system @}}-organisation-transform",
    "include_replaced": false
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["merge-union",
          ["apply-hops", "organisation", {
            "datasets": ["global-organisation t"],
            "where": ["eq", "_S.xxxxxxxx-global-organisation:company-id", "t.global-organisation:company-id"]
          }]
        ],
        ["copy", "_id"],
        ["discard",
          ["is-not-empty", "_T.xxxxxxxx-global-organisation:global-organisation-ni"]
        ]
      ],
      "organisation": [
        ["copy", "global-organisation:*"],
        ["add", "xxxxxxxx-global-organisation:global-organisation-ni",
          ["ni", "_S._id"]
        ]
      ]
    }
  },
  "exclude_completeness": ["xxxxxxxx-global-organisation", "global-organisation"]
}
